<?php

declare(strict_types=1);

namespace WyriHaximus\Broadcast\Generated;

use Psr\Container\ContainerInterface;
use Psr\EventDispatcher\ListenerProviderInterface;

use function React\Async\async;
use function React\Async\await;

/**
 * This class is generated by wyrihaximus/broadcast and inspired by bmack/kart-composer-plugin
 */
abstract class AbstractListenerProvider implements ListenerProviderInterface
{
    /**
     * @return iterable<(callable(object): mixed)>
     */
    final public function getListenersForEvent(object $event): iterable
    {
        // phpcs:disable
        yield from match ($event::class) {
            {% for event, listeners in events -%}
            \{{ event }}::class => [
                {% for listener in listeners %}
                    {% if listener.async -%}
                    {% if listener.static %}static {% endif %}fn (\{{ event }} $event) => await(async({% if listener.static %}static {% endif %}fn (\{{ event }} $event) =>
                    {%- endif -%}
                    {% if listener.static %}
                    {% if listener.async == false %}'{% endif %}\{{ listener.class }}::{{ listener.method }}{% if listener.async == false %}'{% endif %}
                    {% else %}
                    {% if listener.async -%}
                    $this->container()->get(\{{ listener.class }}::class)->{{ listener.method }}
                    {% else %}
                    ([$this->container()->get(\{{ listener.class }}::class), '{{ listener.method }}'])
                    {%- endif -%}
                    {%- endif -%}
                    {%- if listener.async -%}
                    ($event))($event))
                    {%- endif -%},
                {% endfor %}
            ],
            {% endfor -%}
            default => [],
        };
        // phpcs:enable
    }

abstract protected function container(): ContainerInterface;
}
